<!docytpe html>

<html>

<head>

	<meta name="author" content="Maurycy Skier" />

	<title>Disk sectors visualizer</title>

	<script src="parser.js"></script>
	<script src="disk.js"></script>

	<script>

		document.addEventListener( "DOMContentLoaded", function() {

			function resizeCanvas( canvas ) {
				canvas.setAttribute( "width", window.innerWidth );
				canvas.setAttribute( "height", window.innerHeight - 54 );
			}

			/*var*/ canvas = document.getElementById( "canvas" );
			var ctx = canvas.getContext( "2d" );

			if( !ctx )
				throw new Error( "Cannot initialize canvas!" );

			var parser = new Parser();

			var LBA, blockSize, disk;

			parser.on( "header", function( header ) {
				// console.log( "Header:", header );
				document.title = header["Model"];
				LBA = header["End LBA"];
				blockSize = header["Block size"];
			} );

			parser.on( "data", function( data ) {
				resizeCanvas( canvas );
				disk = new Disk( LBA, blockSize, data, ctx );
				disk.sizes( 400, 426, 10, 20, 2 );
				disk.visualize();
			} );

			parser.on( "error", function( message ) {
				alert( message );
			} );

			// document.getElementById( "parse" ).addEventListener( "click", function() {
				var text = document.getElementById( "input" ).value;
				parser.feed( text, false );
			// }, false );

			document.addEventListener( "resize", function() {
				resizeCanvas( canvas );
			}, false );

			document.addEventListener( "keydown", function( event ) {
				var goodKey = true;
				switch( event.keyCode ) {
					// page up, page down
					case 33:
						disk.moveOffset( 0, 0, -1 );
						break;
					case 34:
						disk.moveOffset( 0, 0, 1 );
						break;
					// left, up, right, down
					case 37:
						disk.moveOffset( -1, 0, 0 );
						break;
					case 38:
						disk.moveOffset( 0, -1, 0 );
						break;
					case 39:
						disk.moveOffset( 1, 0, 0 );
						break;
					case 40:
						disk.moveOffset( 0, 1, 0 );
						break;
					default:
						goodKey = false;
				}
				if( goodKey )
					disk.visualize();
			}, false );

		}, false );

	</script>

	<style>

		body {
			padding: 0;
			margin: 0;
			border: 0;
		}

		.wrapper {
		}

		textarea {
			width: 100%;
			height: 100%;
			border: 0;
		}

		.twrap {
			position: absolute;
			top: 0px;
			height: 50px;
			width: 100%;
			border-bottom: solid black;
		}

		.twrap:hover {
			height: 80%;
		}

		canvas {
		}

		.cwrap {
			margin-top: 54px;
		}

	</style>

</head>

<body>

	<div class="wrapper">

		<div class="twrap">
			<textarea id="input">Drive testing
Model : WDC WD2500BEVS-60UST0                   
Firmware : 01.01A01
Serial :      WD-WXE108M82885
LBA : 488397168
Start LBA : 0
End LBA : 488397168
Block size : 256

Block start at 256 time 282ms
Block start at 14848 time 141ms
Block start at 16128 time 125ms
Block start at 21760 time 62ms
Block start at 44288 time 78ms
Block start at 45056 time 78ms
Block start at 46080 time 78ms
Block start at 46592 time 78ms
Block start at 47360 time 78ms
Block start at 47616 time 203ms
Block start at 48128 time 94ms
Block start at 54016 time 78ms
Block start at 55808 time 94ms
Block start at 63488 time 109ms
Block start at 64768 time 141ms
Block start at 65024 time 62ms
Block start at 65792 time 62ms
Block start at 70144 time 78ms
Block start at 83968 time 63ms
Block start at 98816 time 62ms
Block start at 108288 time 172ms
Block start at 115456 time 78ms
Block start at 120832 time 63ms
Block start at 122368 time 63ms
Block start at 132608 time 62ms
Block start at 137984 time 125ms
Block start at 141056 time 63ms
Block start at 152832 time 125ms
Block start at 153600 time 62ms
Block start at 153856 time 78ms
Bad block found, start LBA : 171776
Bad block found, start LBA : 172800
			</textarea>
		</div>


		<div class="cwrap">
			<canvas id="canvas" width="442" height="402">
				<p>Damn, download a better browser!</p>
			</canvas>
			<!-- <input type="button" id="parse" value="Parse" /> -->
		</div>

	</div>

</body>

</html>
